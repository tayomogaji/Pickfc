<mat-toolbar class="toolbar">
  <span>Admin</span>
  <span class="toolbar-spacer"></span>
  <span>
    <button mat-icon-button matTooltip="Add new" matTooltipPosition="before" [matMenuTriggerFor]="addnew">
      <mat-icon>add_circle</mat-icon>
    </button>
    <mat-menu #addnew="matMenu">
      <button mat-menu-item (click)="addedit(comp, team, round, 'c')">Competition</button>
      <button mat-menu-item (click)="addedit(comp, team, round, 't')">Team</button>
      <button mat-menu-item (click)="addedit(comp, team, round, 'r')" [disabled]="compid === 0">Round</button>
    </mat-menu>
  </span>
</mat-toolbar>

<!-- content -->

<div class="row justifiy-content-center">
  <mat-tab-group mat-stretch-tabs="fasle" mat-align-tabs="start" dynamicHeight>

    <!-- comps -->
    <mat-tab label="Competitions">
      <br />
      <div class="row">
        <table mat-table [dataSource]="compsData" class="mat-elevation-z8 full-width">
          <ng-container matColumnDef="pic">
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let comp" (click)="upload(comp, team, true)"><img class="table-pic-borderd half-margin pointer" [src]="pic(comp.pic, 1)"></td>
          </ng-container>
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let comp">{{comp.name}}</td>
          </ng-container>
          <ng-container matColumnDef="opens">
            countdown instead
            <th mat-header-cell *matHeaderCellDef> Opens </th>
            <td mat-cell *matCellDef="let comp">
              <p class="dates"
                 nz-popconfirm
                 nzPopconfirmTitle="{{notifyTitle(comp.openNotified, 'competition is now open?')}}"
                 nzPopconfirmPlacement="top"
                 (nzOnConfirm)="newContentNotify(comp.id, true, comp.openNotified, true)"
                 (nzOnCancel)="closePop()">
                {{comp.open | date: 'd MMM yy (HH:mm)'}}
                <span *ngIf="comp.openNotified"><mat-icon color="accent" matTooltip="Users notified" matTooltipPosition="after" class="notified">mail</mat-icon></span>
              </p>
              
            </td>
          </ng-container>
          <ng-container matColumnDef="teams">
            <th mat-header-cell *matHeaderCellDef> Teams </th>
            <td mat-cell #teams *matCellDef="let comp">
              <span *ngIf="comp.teamsCount < comp.teamsTotal">{{comp.teamsCount}}/</span>{{comp.teamsTotal}}
            </td>
          </ng-container>
          <ng-container matColumnDef="default">
            <th mat-header-cell *matHeaderCellDef> Default </th>
            <td mat-cell *matCellDef="let comp">
              <mat-radio-button color="primary" (change)="defaultSelect($event)" value="{{comp.id}}" [checked]="dcomp.id === comp.id">
              </mat-radio-button>
          </ng-container>
          <ng-container matColumnDef="active">
            <th mat-header-cell *matHeaderCellDef> Active </th>
            <td mat-cell *matCellDef="let comp">
              <mat-checkbox color="primary" [checked]="comp.active" (change)="compActive($event.checked, comp)" [disabled]="!teamsDone(comp)" [matTooltip]="teamsTip(comp)" matTooltipPosition="after">
              </mat-checkbox>
            </td>
          </ng-container>
          <ng-container matColumnDef="reset">
            <th mat-header-cell *matHeaderCellDef> Reset </th>
            <td mat-cell *matCellDef="let comp">
              <button mat-icon-button class="table-icon" color="primary"
                      nz-popconfirm
                      nzPopconfirmTitle="Reset this comp & rounds + player picks & progress & declare winner?"
                      nzPopconfirmPlacement="top"
                      (nzOnConfirm)="compReset(comp)"
                      (nzOnCancel)="closePop()">
                <mat-icon>sync</mat-icon>
              </button>
            </td>

          </ng-container>
          <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef> Edit </th>
            <td mat-cell *matCellDef="let comp">
              <button mat-icon-button class="table-icon edit" (click)="addedit(comp, team, round, 'c')">
                <mat-icon>edit</mat-icon>
              </button>
            </td>
          </ng-container>
          <ng-container matColumnDef="remove">
            <th mat-header-cell *matHeaderCellDef> Remove </th>
            <td mat-cell *matCellDef="let comp">
              <button mat-icon-button color="warn" class="table-icon" (click)="delete(comp, team, round, 'c')">
                <mat-icon>close</mat-icon>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="compsCol"></tr>
          <tr mat-row *matRowDef="let row; columns: compsCol;"></tr>
        </table>
      </div>
    </mat-tab>

    <!-- teams -->

    <mat-tab label="Teams">
      <br />
      <div class="row">
        <button type="button" mat-button style="background-color:#d8d8d8" [matMenuTriggerFor]="teamcomp">
          Competiton: {{compTeamTitle}}
        </button>
        <mat-menu #teamcomp="matMenu" xPosition="before">
          <!--<button mat-menu-item (click)="getTeams()">All</button>-->
          <ng-container *ngIf="comps.length !== 0">
            <button mat-menu-item *ngFor="let c of comps" (click)="compTeams(c.id, c.name)">{{c.name}}</button>
          </ng-container>
        </mat-menu>
        <div *ngIf="teams.length !== 0">
          <mat-form-field class="full-width">
            <mat-label>Search</mat-label>
            <input matInput (keyup)="searchTeam($event)" placeholder="Team" #input />
          </mat-form-field>
          <table mat-table [dataSource]="teamsData" class="mat-elevation-z8" style="height:12px;" matSort>
            <ng-container matColumnDef="pic">
              <th mat-header-cell *matHeaderCellDef> </th>
              <td mat-cell *matCellDef="let team" (click)="upload(comp, team, false)">
                <img class="table-pic half-margin pointer" [src]="pic(team.pic, 2)">
              </td>
            </ng-container>
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
              <td mat-cell *matCellDef="let team">{{team.name}}</td>
            </ng-container>
            <ng-container matColumnDef="rating">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Rating </th>
              <td mat-cell *matCellDef="let team">
                <mat-icon class="table-icon" color="accent" *ngFor="let r of rating(team)">star</mat-icon>
              </td>
            </ng-container>
            <ng-container matColumnDef="competitions">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Competitions </th>
              <td mat-cell *matCellDef="let team">{{team.compsCount}}</td>
            </ng-container>
            <ng-container matColumnDef="edit">
              <th mat-header-cell *matHeaderCellDef> Edit </th>
              <td mat-cell *matCellDef="let team">
                <button mat-icon-button class="table-icon edit" (click)="addedit(comp, team, round, 't')">
                  <mat-icon>edit</mat-icon>
                </button>
              </td>
            </ng-container>
            <ng-container matColumnDef="remove">
              <th mat-header-cell *matHeaderCellDef> Remove </th>
              <td mat-cell *matCellDef="let team">
                <button mat-icon-button color="warn" class="table-icon" (click)="delete(comp, team, round, 't')" [disabled]="team.compsCount > 0">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="teamsCol"></tr>
            <tr mat-row *matRowDef="let row; columns: teamsCol;"></tr>
          </table>
        </div>
      </div>
      <p *ngIf="teams.length === 0" style="text-align:center; margin-top:3em;">
        Add teams to get started.
      </p>
    </mat-tab>

    <!--rounds-->

    <mat-tab label="Rounds" [disabled]="comps === null">
      <br />
      <div class="row">
        <button type="button" mat-button style="background-color:#d8d8d8" [matMenuTriggerFor]="roundcomp">
          Competiton: {{compRoundTitle}}
        </button>
        <mat-menu #roundcomp="matMenu" xPosition="before">
          <ng-container *ngIf="comps.length !== 0">
            <button mat-menu-item *ngFor="let c of comps" (click)="compRounds(c.id, c.name)">{{c.name}}</button> <!--compRounds()-->
          </ng-container>
        </mat-menu>
        <table *ngIf="rounds.length !== 0" mat-table [dataSource]="roundsData" class="mat-elevation-z8" style="height:12px;" matSort>
          <ng-container matColumnDef="round">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Round </th>
            <td mat-cell *matCellDef="let round">{{round.number}}</td>
          </ng-container>
          <ng-container matColumnDef="start">
            <th mat-header-cell *matHeaderCellDef> Start </th>
            <td mat-cell *matCellDef="let round">
              <p class="dates"
                 nz-popconfirm
                 nzPopconfirmTitle="{{notifyTitle(round.startNotified, 'round has started?')}}"
                 nzPopconfirmPlacement="top"
                 (nzOnConfirm)="newContentNotify(round.id, false, round.startNotified, round.current)"
                 (nzOnCancel)="closePop()">
                {{round.start | date: 'd MMM yy (HH:mm)'}}
                <span *ngIf="round.startNotified">
                <mat-icon  matTooltip="Users notified" matTooltipPosition="after" class="notified">mail</mat-icon>
                </span>
              </p>
            </td>
          </ng-container>
          <ng-container matColumnDef="deadline">
            <th mat-header-cell *matHeaderCellDef> Deadline </th>
            <td mat-cell *matCellDef="let round">
              <p class="dates"
                 nz-popconfirm
                 nzPopconfirmTitle="{{notifyTitle(round.deadlineNotified, 'round is approaching its deadline?')}}"
                 nzPopconfirmPlacement="top"
                 (nzOnConfirm)="deadlineNotify(round)"
                 (nzOnCancel)="closePop()">
                {{round.deadline | date: 'd MMM yy (HH:mm)'}}
                <span *ngIf="round.deadlineNotified">
                <mat-icon matTooltip="Users notified" matTooltipPosition="after" class="notified">mail</mat-icon>
                </span>
              </p>
            </td>
          </ng-container>
          <ng-container matColumnDef="current">
            <th mat-header-cell *matHeaderCellDef> Current </th>
            <td mat-cell *matCellDef="let round">
              <button mat-icon-button color="primary" class="table-icon" [disabled]="round.current"
                      nz-popconfirm
                      nzPopconfirmTitle="Make this round current & reset player picks?"
                      nzPopconfirmPlacement="top"
                      (nzOnConfirm)="setCurrent(round)"
                      (nzOnCancel)="closePop()">
                <mat-icon>{{setOK(round.current)}}</mat-icon>
              </button>
            </td>
          </ng-container>

          <ng-container matColumnDef="show">
            <th mat-header-cell *matHeaderCellDef> Show </th>
            <td mat-cell *matCellDef="let round">
              <button mat-icon-button color="primary" (click)="round.show = !round.show; setShow(round)" class="table-icon">
                <mat-icon>{{setOK(round.show)}}</mat-icon>
              </button>
            </td>
          </ng-container>

          <ng-container matColumnDef="fixtures">
            <th mat-header-cell *matHeaderCellDef> Fixtures </th>
            <td mat-cell *matCellDef="let round">
              <button mat-icon-button color="primary" class="table-icon" (click)="fixtures(round)">
                <mat-icon>add</mat-icon>
              </button>
            </td>
          </ng-container>
          <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef> Edit </th>
            <td mat-cell *matCellDef="let round">
              <button mat-icon-button class="table-icon edit" (click)="addedit(comp, team, round, 'r')">
                <mat-icon>edit</mat-icon>
              </button>
            </td>
          </ng-container>
          <ng-container matColumnDef="remove">
            <th mat-header-cell *matHeaderCellDef> Remove </th>
            <td mat-cell *matCellDef="let round">
              <button mat-icon-button color="warn" class="table-icon" (click)="delete(comp, team, round, 'r')" [disabled]="round.current">
                <mat-icon>close</mat-icon>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="roundsCol"></tr>
          <tr mat-row *matRowDef="let row; columns: roundsCol;"></tr>
        </table>
      </div>
      <p *ngIf="rounds.length === 0" style="text-align:center; margin-top:3em;">
        Add rounds to get started.
      </p>
    </mat-tab>
  </mat-tab-group>
</div>
